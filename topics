#!/bin/sh

format='%(refname:short)'
sortby=refname
while test $# -gt 0; do
	case "$1" in
	-v) format='%(refname:short) %(subject)' ;;
	-t) sortby=-authordate ;;
	-u) format='%(refname:short) %(upstream:short)' ;;
	--) break ;;
	 *) echo >&2 "unknown option: $1"; exit 100 ;;
	esac
	shift
done

git for-each-ref --sort=$sortby --format="$format" refs/heads |
egrep '^[a-z]*/' |
perl -pe '
  s/(\S+) /$& . " " x (30 - length($1))/e; # line up subjects
  s/^(.{79}).*/$1/; # truncate long lines
'
